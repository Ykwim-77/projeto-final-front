<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Menu Lateral -->
    <app-sidebar></app-sidebar>
    <!-- Conteúdo Principal -->
    <main>
        <header class="topo">
            <h1 class="titulo-Topo">Dashboard</h1>
            <div class="subtitulo">Uma Visão Geral Do Seu Estoque</div>

            <!-- Alerta de Estoque Baixo -->
            <div class="alertas" *ngIf="lowStockCount > 0 && lowStockAlert">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                    fill="#7A611D">
                    <path
                        d="M480-280q17 0 28.5-11.5T520-320q0-17-11.5-28.5T480-360q-17 0-28.5 11.5T440-320q0 17 11.5 28.5T480-280Zm-40-160h80v-240h-80v240Zm40 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z" />
                </svg>
                <span><strong>Atenção</strong>: {{ lowStockAlert }}</span>
            </div>
        </header>
        <br>
        <section class="conteudo-principal flex gap-xl">
            <!-- Card 1: Total de Produtos -->
            <div class="card">
                <div class="card-title">{{ metricCards[0]?.title || 'Total de Produtos' }}</div>
                <div class="card-value">{{ totalProducts || 0 }}</div>
                <div class="card-variation" [class]="'card-variation ' + (metricCards[0]?.trend || 'neutral')">
                    {{ metricCards[0]?.variation || '-' }}
                </div>
                <div class="imgCard"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#F3F3F3">
                        <path
                            d="M200-80q-33 0-56.5-23.5T120-160v-451q-18-11-29-28.5T80-680v-120q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v120q0 23-11 40.5T840-611v451q0 33-23.5 56.5T760-80H200Zm0-520v440h560v-440H200Zm-40-80h640v-120H160v120Zm200 280h240v-80H360v80Zm120 20Z" />
                    </svg></div>
            </div>

            <!-- Card 2: Valor do Estoque -->
            <div class="card">
                <div class="card-title">{{ metricCards[1]?.title || 'Valor do Estoque' }}</div>
                <div class="card-value">{{ stockValue || 'R$ 0,00' }}</div>
                <div class="card-variation" [class]="'card-variation ' + (metricCards[1]?.trend || 'neutral')">
                    {{ metricCards[1]?.variation || '-' }}
                </div>
                <div class="imgCard2"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#F3F3F3">
                        <path d="m256-240-56-56 384-384H240v-80h480v480h-80v-344L256-240Z" />
                    </svg> </div>
            </div>

            <!-- Card 3: Itens em Baixa -->
            <div class="card">
                <div class="card-title">{{ metricCards[2]?.title || 'Itens em Baixa' }}</div>
                <div class="card-value">{{ lowStockCount || 0 }}</div>
                <div class="card-variation" [class]="'card-variation ' + (metricCards[2]?.trend || 'neutral')">
                    {{ metricCards[2]?.variation || '-' }}
                </div>
                <div class="imgCard3"><svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                        width="24px" fill="#F3F3F3">
                        <path d="M360-200v-80h264L160-744l56-56 464 464v-264h80v400H360Z" />
                    </svg> </div>
            </div>

            <!-- Card 4: Saídas do Mês -->
            <div class="card">
                <div class="card-title">{{ metricCards[3]?.title || 'Saídas do Mês' }}</div>
                <div class="card-value">{{ metricCards[3]?.value || 0 }}</div>
                <div class="card-variation" [class]="'card-variation ' + (metricCards[3]?.trend || 'neutral')">
                    {{ metricCards[3]?.variation || '-' }}
                </div>
                <div class="imgCard4"><svg id="imagem" xmlns="http://www.w3.org/2000/svg" height="24px"
                        viewBox="0 -960 960 960" width="24px" fill="#F3F3F3">
                        <path
                            d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-114 59.5-210.5T301-838q1 19 4 38.5t10 45.5q-72 44-113.5 116.5T160-480q0 134 93 227t227 93q134 0 227-93t93-227q0-85-41.5-158T644-755q7-26 10-45.5t5-37.5q102 51 161.5 147T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-160q-100 0-170-70t-70-170q0-58 25.5-109t72.5-85q5 15 11 34.5t16 48.5q-22 23-33.5 51T320-480q0 66 47 113t113 47q66 0 113-47t47-113q0-32-11.5-60T595-591q8-24 14.5-44.5T621-674q47 34 73 85t26 109q0 100-70 170t-170 70Zm-40-380q-37-112-48.5-157.5T380-860q0-42 29-71t71-29q42 0 71 29t29 71q0 37-11.5 82.5T520-620h-80Zm40 220q-33 0-56.5-23.5T400-480q0-33 23.5-56.5T480-560q33 0 56.5 23.5T560-480q0 33-23.5 56.5T480-400Z" />
                    </svg> </div>
            </div>
        </section>
        <!-- Gráficos Principais -->
        <section class="graficos-container">
            <!-- Gráfico de Pizza -->
            <div class="grafico-card">
                <div class="card-title">Distribuição por Categoria</div>
                <canvas #pieChart width="400" height="300"></canvas>
            </div>

            <!-- Gráfico de Barras -->
            <div class="grafico-card">
                <div class="card-title">Top Produtos por Valor</div>
                <canvas #barChart width="400" height="300"></canvas>
            </div>
        </section>

        <!-- Segunda Linha de Gráficos -->
        <section class="graficos-container">

            <div class="grafico-card">
                <div class="card-title">Produtos em Baixa</div>
                <div class="low-stock-list" *ngIf="lowStockProducts.length > 0">
                    <div class="low-stock-item" *ngFor="let produto of lowStockProducts; let i = index">
                        <div class="item-index">{{ i + 1 }}</div>
                        <div class="product-info">
                            <span class="product-name">{{ produto.name }}</span>
                            <span class="product-category">{{ produto.category }}</span>
                            <span class="product-quantity" style="color: red; font-weight: bold;">
                                ({{ produto.quantity }} unidades)
                            </span>
                        </div>
                        <div class="stock-alert">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Estoque Baixo</span>
                        </div>
                    </div>
                </div>

                <div class="no-low-stock" *ngIf="lowStockProducts.length === 0 && produtos && produtos.length > 0">
                    <i class="fas fa-check-circle"></i>
                    <p>Nenhum produto com estoque baixo</p>
                    <small>Todos os produtos estão acima do limite mínimo</small>
                </div>

                <div class="no-products" *ngIf="!produtos || produtos.length === 0">
                    <i class="fas fa-box-open"></i>
                    <p>Nenhum produto cadastrado</p>
                    <small>Adicione produtos para monitorar o estoque</small>
                </div>
            </div>
        </section>

        <!-- Movimentações -->
        <section class="graficos-container">
            <div class="cardMovimentacoes">
                <div class="card-title">Últimas Movimentações</div>
                <div class="movimentacoes-list" *ngIf="movimentacoes.length > 0">
                    <div class="movimentacao-item" *ngFor="let mov of movimentacoes">
                        <div class="mov-icon" [class]="'mov-' + mov.tipo">
                            <i [class]="mov.tipo === 'entrada' ? 'fas fa-arrow-down' : 'fas fa-arrow-up'"></i>
                        </div>
                        <div class="mov-details">
                            <span class="mov-produto">{{ mov.produto }}</span>
                            <span class="mov-info">{{ mov.quantidade }} unidades - {{ mov.data | date:'dd/MM/yyyy HH:mm'
                                }}</span>
                        </div>
                        <div class="mov-tipo-badge" [class]="'badge-' + mov.tipo">
                            {{ mov.tipo === 'entrada' ? 'Entrada' : 'Saída' }}
                        </div>
                    </div>
                </div>
                <div class="no-movimentacoes" *ngIf="movimentacoes.length === 0">
                    <i class="fas fa-exchange-alt"></i>
                    <p>Nenhuma movimentação registrada</p>
                    <small>As movimentações aparecerão aqui quando houver alterações no estoque</small>
                </div>
            </div>
        </section>
        <!--isso é só pra teste e visualização melhor, depois removo -->
        <br>
        <br>
    </main>
</body>