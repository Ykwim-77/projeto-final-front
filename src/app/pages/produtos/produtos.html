<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head><body>
    <nav class="sidebar">
        <div class="logo-container">
            <div class="logo">
                <!-- Substitua pelo caminho correto da sua imagem -->
                <img src="assets/imagens/logoprogestao.png"alt="Logo StockSmart" class="logoTopo">
                <span>ProGest</span>
                <div id="tagline">Gestão Inteligente</div>
            </div>
        </div>
        <hr>
        <div class="menu-container">
            <a routerLink="/home" class="menu-item" >
                <i class="fas fa-chart-line"></i>
                <span class="menu-text">Dashboard</span>
            </a>
            <a routerLink="/produtos" class="menu-item active">
                <i class="fas fa-box-open"></i>
                <span class="menu-text">Produtos</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-exchange-alt"></i>
                <span class="menu-text">Movimentações</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-chart-bar"></i>
                <span class="menu-text">Relatórios</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-robot"></i>
                <span class="menu-text">Previsão IA</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-file-invoice-dollar"></i>
                <span class="menu-text">Planos</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-cog"></i>
                <span class="menu-text">Configurações</span>
            </a>
            <a href="#" class="menu-item">
                <i class="fas fa-users"></i>
                <span class="menu-text">Usuários</span>
            </a>
        </div>
        <hr>    
        <div class="user-section">
            <div class="user-info">

                <div class="user-avatar">{{ usuarioIniciais || 'U' }}</div>
                <div class="user-details">
                    <div class="user-name">{{ usuarioNome || 'Usuário' }}</div>
                    <div class="user-email">{{ usuarioEmail || 'email@exemplo.com' }}</div>
                </div>
            </div>
            <button class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sair</span>
            </button>
        </div>
    </nav>

    <main>
        <header class="topo">
            <div class="topo-texto">
                <h1 class="titulo-Topo">Produtos</h1>
                <div class="subtitulo">Gerencie o catálogo do seu estoque</div>
            </div>
            <div class="adicionar-produto-container">
                <div class="adicionar-produto" (click)="abrirCardCadastro()">
                    <i class="fas fa-plus"></i>
                    <div class="adicionar-produto-text">Adicionar Produto</div>
                </div>
            </div>
        </header>

        <!-- Formulário de cadastro/edição -->
        <div class="overlay-cadastro" *ngIf="showCardCadastro" (click)="fecharCardCadastro()">
            <div class="cadastro-card" (click)="$event.stopPropagation()">
                <div class="cadastro-header">
                    <h3>{{ produtoEditando ? 'Editar Produto' : 'Novo Produto' }}</h3>
                    <button type="button" class="btn-fechar-modal" (click)="fecharCardCadastro()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form (submit)="$event.preventDefault(); salvarProduto();" class="form-cadastro">
                    <div class="campo-duplo">
                        <div class="campo">
                            <label><i class="fas fa-tag"></i> Nome do Produto *</label>
                            <input type="text" [(ngModel)]="novoProduto.nome" name="nome" required class="input" placeholder="Ex: Notebook Dell" />
                        </div>
                        <div class="campo">
                            <label><i class="fas fa-barcode"></i> Código Público (SKU)</label>
                            <input type="text" [(ngModel)]="novoProduto.codigo_publico" name="codigo_publico" class="input" placeholder="Ex: PROD-001" />
                        </div>
                    </div>
                    
                    <div class="campo-duplo">
                        <div class="campo">
                            <label><i class="fas fa-dollar-sign"></i> Preço Unitário</label>
                            <input type="number" step="0.01" min="0" [(ngModel)]="novoProduto.preco_unitario" name="preco_unitario" class="input" placeholder="0.00" />
                        </div>
                        <div class="campo">
                            <label><i class="fas fa-ruler"></i> Categorias</label>
                            <select [(ngModel)]="novoProduto.unidade_medida" name="unidade_medida" class="input">
                                <option value="">Selecione...</option>
                                <option value="UN">Maquinas e Equipamentos</option>
                                <option value="KG">Quilograma (KG)</option>
                                <option value="G">Grama (G)</option>
                                <option value="L">Litro (L)</option>
                                <option value="ML">Mililitro (ML)</option>
                                <option value="M">Metro (M)</option>
                                <option value="CM">Centímetro (CM)</option>
                                <option value="CX">Caixa (CX)</option>
                                <option value="PC">Peça (PC)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="campo">
                        <label><i class="fas fa-folder"></i> Categoria</label>
                        <input type="text" [(ngModel)]="novoProduto.categoria" name="categoria" class="input" placeholder="Ex: Eletrônicos, Informática..." list="categorias-list" />
                        <datalist id="categorias-list">
                            <option *ngFor="let cat of categoriasUnicas" [value]="cat"></option>
                        </datalist>
                    </div>
                    
                    <div class="campo">
                        <label><i class="fas fa-align-left"></i> Descrição</label>
                        <textarea [(ngModel)]="novoProduto.descricao" name="descricao" rows="4" class="input" placeholder="Descrição detalhada do produto..."></textarea>
                    </div>
                    
                    <div class="campo">
                        <label><i class="fas fa-truck"></i> ID Fornecedor (Opcional)</label>
                        <input type="number" [(ngModel)]="novoProduto.id_fornecedor" name="id_fornecedor" class="input" placeholder="ID do fornecedor" />
                    </div>
                    
                    <div class="acoes-form">
                        <button type="button" class="btn-cancel" (click)="fecharCardCadastro()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn-salvar">
                            <i class="fas fa-save"></i> {{ produtoEditando ? 'Salvar Alterações' : 'Adicionar Produto' }}
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <section>
            <div class="search-bar">
                <input type="text" placeholder="Pesquisar por nome, sku ou categoria...">
                <i class="fas fa-search"></i>
            </div>
            <div class="botao-opcoes-container">
                <div class="botao-opcoes" 
                     [class.active]="visualizacao === 'grade'" 
                     (click)="mudarVisualizacao('grade')">
                    <div class="adicionar-produto-text">Grade</div>
                </div>
            </div>
            <div class="botao-opcoes-container">
                <div class="botao-opcoes-tabela" 
                     [class.active]="visualizacao === 'tabela'" 
                     (click)="mudarVisualizacao('tabela')">
                    <div class="adicionar-produto-text">Tabela</div>
                </div>
            </div>
        </section> 

                <!-- Lista de Produtos em Grade -->
        <!-- CORREÇÃO NA VISUALIZAÇÃO GRADE -->
        <section *ngIf="visualizacao === 'grade'" class="produtos-grade">
          <div *ngFor="let produto of produtos" class="produto-card">
              <div class="produto-header">
                  <h3>{{ produto.nome || 'Produto sem nome' }}</h3>
                  <span class="produto-categoria">{{ produto.categoria || 'Sem categoria' }}</span>
              </div>
              
              <div class="produto-info">
                  <div class="info-item">
                      <span class="label">Código:</span>
                      <span class="value">{{ produto.id_patrimonio || 'N/A' }}</span>
                  </div>
                  <div class="info-item">
                      <span class="label">Preço:</span>
                      <span class="value preco">R$ {{ (produto.preco_unitario || 0) | number:'1.2-2' }}</span>
                  </div>
                  <div class="info-item">
                      <span class="label">Estoque:</span>
                      <span class="value quantidade" [class.estoque-baixo]="(produto.estoque || 0) < 5">
                          {{ produto.estoque || 0 }} unidades
                      </span>
                  </div>
              </div>

              <div class="produto-actions">
                  <button class="btn-editar" (click)="editarProduto(produto)">
                      <i class="fas fa-edit"></i> Editar
                  </button>
                  <button class="btn-excluir" (click)="excluirProduto(produto.id_produto || produto.id_patrimonio)">
                      <i class="fas fa-trash"></i> Excluir
                  </button>
              </div>
          </div>
          <div *ngIf="produtos.length === 0" class="sem-produtos">
              <i class="fas fa-box-open"></i>
              <p>Nenhum produto cadastrado</p>
          </div>
        </section>
                <!-- Lista de Produtos em Tabela -->
        <!-- CORREÇÃO NA VISUALIZAÇÃO TABELA -->
        <section *ngIf="visualizacao === 'tabela'" class="tabela-produtos" >
          <div class="tabela-container">
            <table class="tabela">
              <thead>
                <tr>
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span class="titulo-coluna">Nome</span>
                      <button class="btn-filtro" 
                              [class.active]="filtroAberto === 'nome'"
                              [class.has-filter]="filtros.nome && filtros.nome.trim() !== ''"
                              (click)="toggleFiltro('nome')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'nome'">
                        <input type="text" 
                              [(ngModel)]="filtros.nome" 
                              (ngModelChange)="aplicarFiltros()"
                              placeholder="Buscar por nome..."
                              class="input-filtro">
                        <button class="btn-limpar" (click)="filtros.nome = ''; aplicarFiltros()">Limpar</button>
                      </div>
                    </div>
                  </th>
                
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>SKU</span>
                      <button class="btn-filtro" 
                              [class.active]="filtroAberto === 'sku'"
                              [class.has-filter]="filtros.sku && filtros.sku.trim() !== ''"
                              (click)="toggleFiltro('sku')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'sku'">
                        <input type="text" 
                              [(ngModel)]="filtros.sku" 
                              (ngModelChange)="aplicarFiltros()"
                              placeholder="Buscar por SKU..."
                              class="input-filtro">
                        <button class="btn-limpar" (click)="filtros.sku = ''; aplicarFiltros()">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Categoria</span>
                      <button class="btn-filtro" 
                              [class.active]="filtroAberto === 'categoria'"
                              [class.has-filter]="filtros.categoria && filtros.categoria.trim() !== ''"
                              (click)="toggleFiltro('categoria')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'categoria'">
                        <select [(ngModel)]="filtros.categoria" (ngModelChange)="aplicarFiltros()" class="select-filtro">
                          <option value="">Todas categorias</option>
                          <option *ngFor="let categoria of categoriasUnicas" [value]="categoria">
                            {{ categoria }}
                          </option>
                        </select>
                        <button class="btn-limpar" (click)="filtros.categoria = ''; aplicarFiltros()">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Preço</span>
                      <button class="btn-filtro" 
                              [class.active]="filtroAberto === 'preco'"
                              [class.has-filter]="filtros.precoMin || filtros.precoMax"
                              (click)="toggleFiltro('preco')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'preco'">
                        <div class="faixa-preco-filtro">
                          <label>Preço mínimo:</label>
                          <input type="number" 
                                [(ngModel)]="filtros.precoMin" 
                                (ngModelChange)="aplicarFiltros()"
                                placeholder="0,00"
                                class="input-filtro-pequeno"
                                min="0">
                          <label>Preço máximo:</label>
                          <input type="number" 
                                [(ngModel)]="filtros.precoMax" 
                                (ngModelChange)="aplicarFiltros()"
                                placeholder="10000,00"
                                class="input-filtro-pequeno"
                                min="0">
                        </div>
                        <button class="btn-limpar" (click)="limparFiltroPreco()">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th class="coluna-filtravel">
                    <div class="header-com-filtro">
                      <span>Estoque</span>
                      <button class="btn-filtro" 
                              [class.active]="filtroAberto === 'estoque'"
                              [class.has-filter]="filtros.estoqueMin && filtros.estoqueMin > 0"
                              (click)="toggleFiltro('estoque')">
                        <i class="fas fa-filter"></i>
                      </button>
                      <div class="dropdown-filtro" *ngIf="filtroAberto === 'estoque'">
                        <label>Estoque mínimo:</label>
                        <input type="number" 
                              [(ngModel)]="filtros.estoqueMin" 
                              (ngModelChange)="aplicarFiltros()"
                              placeholder="0"
                              class="input-filtro"
                              min="0">
                        <button class="btn-limpar" (click)="filtros.estoqueMin = 0; aplicarFiltros()">Limpar</button>
                      </div>
                    </div>
                  </th>
                  
                  <th>Valor Total</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody>
                <tr class="linha-vertical" *ngFor="let produto of produtosFiltrados" 
                    [class.estoque-baixo]="(produto.quantidade || 0) < 5">
                  <td class="nome-produto">
                    <strong>{{ produto.nome || 'Produto sem nome' }}</strong>
                    <small *ngIf="produto.descricao">{{ produto.descricao }}</small>
                  </td>
                  <td class="sku">{{ produto.sku || 'N/A' }}</td>
                  <td class="categoria">
                    <span class="categoria-badge">{{ produto.categoria || 'Sem categoria' }}</span>
                  </td>
                  <td class="preco">R$ {{ (produto.preco_unitario || 0) | number:'1.2-2' }}</td>
                  <td class="estoque">
                    <span [class.estoque-critico]="(produto.quantidade || 0) < 5">
                      {{ produto.quantidade || 0 }} unidades
                    </span>
                    <div *ngIf="(produto.quantidade || 0) < 5" class="estoque-alerta">
                      <i class="fas fa-exclamation-triangle"></i>
                      Estoque baixo
                    </div>
                  </td>
                  <td class="valor-total">
                    R$ {{ ((produto.preco_unitario || 0) * (produto.quantidade || 0)) | number:'1.2-2' }}
                  </td>
                  <td class="acoes">
                    <button class="btn-acao btn-editar-tabela" 
                            (click)="editarProduto(produto)"
                            title="Editar produto">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-acao btn-excluir-tabela" 
                            (click)="excluirProduto(produto.id_produto || produto.id_patrimonio)"
                            title="Excluir produto">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
            
            <div *ngIf="produtosFiltrados.length === 0" class="sem-produtos">
              <i class="fas fa-box-open"></i>
              <p>Nenhum produto encontrado</p>
            </div>
          </div>
        </section>
    </main>
</body>